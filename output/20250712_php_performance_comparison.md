---
marp: true
theme: custom
---

# PHP実行環境パフォーマンス比較

4つの実行環境でパフォーマンス測定を実施

---

## リソース使用量比較

CPU使用率とメモリ使用量の比較

| 環境 | 平均CPU使用率 | 平均メモリ使用量 | CPU効率 | メモリ効率 |
| --- | --- | --- | --- | --- |
| Apache+PHP | 35.77% | 360.08MiB | 要改善 | 普通 |
| Nginx+PHP | 34.32% | **88.75MiB** | 普通 | **最優秀** |
| **Swoole** | **32.03%** | 962.9MiB | **良好** | 要注意 |
| **FrankenPHP** | **20.47%** | 288.4MiB | **最優秀** | 良好 |

---

## PHP実行環境比較結果

| 環境 | 平均レスポンス | P90レスポンス | スループット |
| --- | --- | --- | --- |
| Apache+PHP | 18.46ms | 27.99ms | 28.49 RPS |
| Nginx+PHP | 17.41ms | 25.54ms | 28.06 RPS |
| Swoole | 13.26ms | 20.51ms | 28.58 RPS |
| **FrankenPHP** | **12.74ms** | **19.51ms** | **28.65 RPS** |

<!-- FrankenPHPが最高のレスポンス性能、Nginx+PHPが最少メモリ使用量 -->

---

## レスポンス時間詳細比較

各処理別のレスポンス時間（P90）

| 環境 | POST処理（記事作成） | GET処理（記事取得） |
| --- | --- | --- |
| Apache+PHP | 49.61ms | 22.45ms |
| Nginx+PHP | 50.53ms | 20.69ms |
| **Swoole** | **45.64ms** | **16.38ms** |
| **FrankenPHP** | **45.86ms** | **15.48ms** |

<!-- FrankenPHP、Swooleが高速。従来環境より30-40%高速 -->

---

意外と差がないように見えます
ここで影の立役者の登場
opcache

Apache + mod_phpを例に違いを比較


---

## レスポンスタイム比較

同じ環境でもこれだけの違いが
| 項目 | Memcache無し | Memcache有り | 改善率 |
| --- | --- | --- | --- |
| **平均使用CPU** | 290% | 48% | **83%削減** |
| **平均使用メモリ** | 2.175 **GiB** | 462.1 **MiB** | **79%削減** |
| **平均レスポンス** | 90.31ms | 18.46ms | **80%改善** |
| **P90レスポンス** | 119.35ms | 27.99ms | **77%改善** |
| **P95レスポンス** | 130.59ms | 36.91ms | **72%改善** |


---

## Memcacheの導入により大幅な性能改善

こんな簡単な設定でも効果<span style="font-size: 2em;">大</span>
```
- opcache.enable=1  // 有効にする
- opcache.enable_cli=1 // cliモードでも有効にする
- opcache.memory_consumption=128 // キャッシュサイズの指定
```
WebサーバーやDBのチューニングも重要だけれど
PHPのチューニングも忘れずに！



---

## 技術的特徴と推奨用途（続き）

### Nginx+PHP-FPM
- **特徴**: 省メモリ、安定性
- **適用**: コスト重視、長時間稼働
- **推奨**: 一般的なWebアプリケーション

### Apache+mod_php
- **特徴**: 設定簡単、互換性良好
- **適用**: レガシー環境、開発環境
- **推奨**: 互換性重視のシステム

---

## まとめ・推奨事項

### パフォーマンス重視
1. **FrankenPHP**: 総合最優秀
2. **Swoole**: 非同期処理に最適

### CPU効率重視
1. **FrankenPHP**: 最小CPU使用率
2. **Swoole**: バランス型

### メモリ効率重視
1. **Nginx+PHP**: 最小メモリ使用量
2. **FrankenPHP**: バランス型

### 用途別推奨
- **API サーバー**: FrankenPHP
- **リアルタイム**: Swoole
- **一般Web**: Nginx+PHP
- **レガシー**: Apache+PHP

<!-- 環境選択時はトラフィック量とインフラコストを総合的に検討 -->